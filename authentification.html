<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/authentification.css">
    <title>flourish.com</title>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <h1>Flourish</h1>
        </div>
    </nav>

    <!-- Header -->
    <div class="header">
        <h2>Welcome to Flourish</h2>
        <p>Are you ready to level up your daily habits?</p>
    </div>

    <!-- Container d'authentification -->
    <div class="auth-container">
        <div class="auth-box">
            <!-- Onglets -->
            <div class="auth-tabs">
                <div class="tab active" onclick="switchTab('login')">Se connecter</div>
                <div class="tab" onclick="switchTab('signup')">S'inscrire</div>
            </div>

            <!-- Contenu des formulaires -->
            <div class="form-content">
                <!-- Formulaire de connexion -->
                <div class="form-section active" id="login-form">
                    <h3 style="margin-bottom: 30px; color: #333; font-size: 1.5em;">Connexion</h3>
                    
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="votre@email.com" required>
                        <div class="error-message" id="login-email-error">Veuillez entrer un email valide</div>
                    </div>

                    <div class="form-group">
                        <label for="login-password">Mot de passe</label>
                        <input type="password" id="login-password" placeholder="••••••••" required>
                        <div class="error-message" id="login-password-error">Le mot de passe est requis</div>
                    </div>

                    <button class="btn-submit" onclick="handleLogin()">Se connecter</button>

                    <div class="form-footer">
                        <a href="#" onclick="alert('Fonctionnalité à venir'); return false;">Mot de passe oublié?</a>
                    </div>
                </div>

                <!-- Formulaire d'inscription -->
                <div class="form-section" id="signup-form">
                    <h3 style="margin-bottom: 30px; color: #333; font-size: 1.5em;">Créer un compte</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="signup-firstname">Prénom</label>
                            <input type="text" id="signup-firstname" placeholder="Jean" required>
                            <div class="error-message" id="signup-firstname-error">Le prénom est requis</div>
                        </div>

                        <div class="form-group">
                            <label for="signup-lastname">Nom</label>
                            <input type="text" id="signup-lastname" placeholder="Dupont" required>
                            <div class="error-message" id="signup-lastname-error">Le nom est requis</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="signup-age">Âge</label>
                        <input type="number" id="signup-age" placeholder="18" min="13" max="120" required>
                        <div class="error-message" id="signup-age-error">Vous devez avoir au moins 13 ans</div>
                    </div>

                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" placeholder="votre@email.com" required>
                        <div class="error-message" id="signup-email-error">Veuillez entrer un email valide</div>
                    </div>

                    <div class="form-group">
                        <label for="signup-password">Mot de passe</label>
                        <input type="password" id="signup-password" placeholder="••••••••" required>
                        <div class="password-strength">
                            <div class="password-strength-bar"></div>
                        </div>
                        <div class="password-strength-text"></div>
                        <div class="error-message" id="signup-password-error">Le mot de passe doit contenir au moins 8 caractères</div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="terms" required>
                        <label for="terms">
                            J'accepte les <a href="#" onclick="showTerms(); return false;">conditions d'utilisation</a> 
                            et la <a href="#" onclick="showPrivacy(); return false;">politique de confidentialité</a>
                        </label>
                    </div>

                    <button class="btn-submit" onclick="handleSignup()">Créer mon compte</button>

                    <div class="form-footer">
                        Vous avez déjà un compte? <a href="#" onclick="switchTab('login'); return false;">Se connecter</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Zone de notification -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notification-title"></div>
        <div class="notification-message" id="notification-message"></div>
    </div>

    <script>
        // Base de données simulée (localStorage)
        function getUsers() {
            const users = localStorage.getItem('flourish_users');
            return users ? JSON.parse(users) : [];
        }

        function saveUsers(users) {
            localStorage.setItem('flourish_users', JSON.stringify(users));
        }

        function saveCurrentUser(user) {
            localStorage.setItem('flourish_current_user', JSON.stringify(user));
        }

        // Basculer entre les onglets
        function switchTab(tab) {
            // Mettre à jour les onglets
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Mettre à jour le contenu
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });

            if (tab === 'login') {
                document.getElementById('login-form').classList.add('active');
            } else {
                document.getElementById('signup-form').classList.add('active');
            }

            // Réinitialiser les erreurs
            clearErrors();
        }

        // Validation email
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        // Force du mot de passe
        document.getElementById('signup-password')?.addEventListener('input', function(e) {
            const password = e.target.value;
            const strengthBar = document.querySelector('.password-strength-bar');
            const strengthText = document.querySelector('.password-strength-text');
            const strengthContainer = document.querySelector('.password-strength');

            if (password.length === 0) {
                strengthContainer.classList.remove('show');
                strengthText.classList.remove('show');
                return;
            }

            strengthContainer.classList.add('show');
            strengthText.classList.add('show');

            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^a-zA-Z0-9]/.test(password)) strength++;

            strengthBar.className = 'password-strength-bar';
            if (strength <= 1) {
                strengthBar.classList.add('weak');
                strengthText.textContent = '⚠️ Faible - Ajoutez des chiffres et majuscules';
                strengthText.style.color = '#e53e3e';
            } else if (strength <= 2) {
                strengthBar.classList.add('medium');
                strengthText.textContent = '⚡ Moyen - Ajoutez des caractères spéciaux';
                strengthText.style.color = '#ed8936';
            } else {
                strengthBar.classList.add('strong');
                strengthText.textContent = '✅ Fort - Excellent mot de passe!';
                strengthText.style.color = '#48bb78';
            }
        });

        // Gérer la connexion
        function handleLogin() {
            clearErrors();

            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;

            let hasError = false;

            // Validation email
            if (!email || !isValidEmail(email)) {
                showError('login-email', 'login-email-error');
                hasError = true;
            }

            // Validation mot de passe
            if (!password) {
                showError('login-password', 'login-password-error');
                hasError = true;
            }

            if (hasError) return;

            // Vérifier les identifiants
            const users = getUsers();
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                saveCurrentUser(user);
                showNotification('Connexion réussie!', `Bienvenue ${user.firstname}! Redirection...`, 'success');
                setTimeout(() => {
                    window.location.href = 'tracker.html'; // Rediriger vers l'application
                }, 1500);
            } else {
                showNotification('Erreur de connexion', 'Email ou mot de passe incorrect', 'error');
            }
        }

        // Gérer l'inscription
        function handleSignup() {
            clearErrors();

            const firstname = document.getElementById('signup-firstname').value.trim();
            const lastname = document.getElementById('signup-lastname').value.trim();
            const age = parseInt(document.getElementById('signup-age').value);
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const termsAccepted = document.getElementById('terms').checked;

            let hasError = false;

            // Validation prénom
            if (!firstname) {
                showError('signup-firstname', 'signup-firstname-error');
                hasError = true;
            }

            // Validation nom
            if (!lastname) {
                showError('signup-lastname', 'signup-lastname-error');
                hasError = true;
            }

            // Validation âge
            if (!age || age < 13) {
                showError('signup-age', 'signup-age-error');
                hasError = true;
            }

            // Validation email
            if (!email || !isValidEmail(email)) {
                showError('signup-email', 'signup-email-error');
                hasError = true;
            }

            // Validation mot de passe
            if (!password || password.length < 8) {
                showError('signup-password', 'signup-password-error');
                hasError = true;
            }

            // Validation conditions
            if (!termsAccepted) {
                showNotification('Conditions requises', 'Veuillez accepter les conditions d\'utilisation', 'error');
                hasError = true;
            }

            if (hasError) return;

            // Vérifier si l'email existe déjà
            const users = getUsers();
            if (users.some(u => u.email === email)) {
                showError('signup-email', 'signup-email-error');
                document.getElementById('signup-email-error').textContent = 'Cet email est déjà utilisé';
                document.getElementById('signup-email-error').classList.add('show');
                showNotification('Email déjà utilisé', 'Cet email est déjà associé à un compte', 'error');
                return;
            }

            // Créer le nouvel utilisateur
            const newUser = {
                id: Date.now(),
                firstname,
                lastname,
                age,
                email,
                password,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            saveUsers(users);
            saveCurrentUser(newUser);

            showNotification('Compte créé!', `Bienvenue ${firstname}! Votre compte a été créé avec succès.`, 'success');
            
            setTimeout(() => {
                window.location.href = 'tracker.html'; // Rediriger vers l'application
            }, 1500);
        }

        // Afficher une erreur
        function showError(inputId, errorId) {
            document.getElementById(inputId).classList.add('error');
            document.getElementById(errorId).classList.add('show');
        }

        // Effacer toutes les erreurs
        function clearErrors() {
            document.querySelectorAll('input').forEach(input => {
                input.classList.remove('error');
            });
            document.querySelectorAll('.error-message').forEach(error => {
                error.classList.remove('show');
            });
        }

        // Afficher une notification
        function showNotification(title, message, type) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');

            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            notification.className = `notification show ${type}`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Afficher les conditions
        function showTerms() {
            alert('Conditions d\'utilisation:\n\n1. Vous devez avoir au moins 13 ans pour utiliser ce service.\n2. Vous êtes responsable de la confidentialité de votre compte.\n3. L\'utilisation doit être conforme aux lois en vigueur.\n4. Nous nous réservons le droit de suspendre tout compte en cas d\'abus.\n\nPour la version complète, consultez notre site web.');
        }

        // Afficher la politique de confidentialité
        function showPrivacy() {
            alert('Politique de confidentialité:\n\n1. Vos données personnelles sont stockées de manière sécurisée.\n2. Nous ne partageons pas vos informations avec des tiers.\n3. Vous pouvez demander la suppression de vos données à tout moment.\n4. Les cookies sont utilisés pour améliorer votre expérience.\n\nPour la version complète, consultez notre site web.');
        }

        // Permettre la soumission avec Enter
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const loginForm = document.getElementById('login-form');
                const signupForm = document.getElementById('signup-form');
                
                if (loginForm.classList.contains('active')) {
                    handleLogin();
                } else if (signupForm.classList.contains('active')) {
                    handleSignup();
                }
            }
        });
    </script>
</body>
</html>